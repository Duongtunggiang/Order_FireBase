<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu√°n Tr√† S·ªØa & ƒê·ªì ƒÇn - Single Page App</title>
    <!-- Tailwind CSS via CDN (for development) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    /* Custom Tailwind config for production */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
    }

    /* Hide scrollbar for webkit browsers */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #fef3c7; }
    ::-webkit-scrollbar-thumb { background: #d97706; border-radius: 10px; }

    /* Custom utilities */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    </style>
    <!-- Lucide Icons for nice, clean icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updatePassword, EmailAuthProvider, reauthenticateWithCredential } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, addDoc, updateDoc, deleteDoc, doc, getDocs, where, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // C·∫•u h√¨nh Firebase v√† Kh·ªüi t·∫°o
        setLogLevel('Debug');
        const appId = 'order-app'; // App ID cho qu√°n tr√† s·ªØa

        // Firebase config cho project order-d8a0c
        const firebaseConfig = {
            apiKey: "AIzaSyCGs3xD2uC153yGlV7IpRftllAKx-NHt88",
            authDomain: "order-d8a0c.firebaseapp.com",
            projectId: "order-d8a0c",
            storageBucket: "order-d8a0c.firebasestorage.app",
            messagingSenderId: "559568129038",
            appId: "1:559568129038:web:dd1ebcefb23f7cf03dc05f"
        };
        const __initial_auth_token = null; // For Canvas environment - set to null for direct usage

        let app, db, auth, storage, userId;
        let menuItems = [];
        let cart = {}; // { itemId: { item, quantity } }
        let currentView = 'customer'; // 'customer', 'login', 'admin', 'preview'
        let currentCategory = 'ƒê·ªì U·ªëng'; // 'ƒê·ªì U·ªëng', 'ƒê·ªì ƒÇn', 'ƒê·ªì Nh·∫≠u'
        let isAdmin = false;
        let isPreviewMode = false; // Admin ƒëang xem nh∆∞ kh√°ch h√†ng
        let categories = ['ƒê·ªì U·ªëng', 'ƒê·ªì ƒÇn', 'ƒê·ªì Nh·∫≠u']; // Danh s√°ch categories c√≥ th·ªÉ th√™m
        let drinkSizes = ['S', 'M', 'L', 'Big Size']; // Size cho ƒë·ªì u·ªëng

        // --- H√†m h·ªó tr·ª£ chung ---
        function renderLucideIcons() {
            lucide.createIcons();
        }

        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcm16, sampleRate = 16000) {
            const numChannels = 1;
            const numSamples = pcm16.length;
            const bytesPerSample = 2;
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = numSamples * bytesPerSample;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            let offset = 0;

            // RIFF chunk
            view.setUint32(offset, 0x52494646, false); offset += 4; // "RIFF"
            view.setUint32(offset, 36 + dataSize, true); offset += 4; // file size - 8
            view.setUint32(offset, 0x57415645, false); offset += 4; // "WAVE"

            // fmt chunk
            view.setUint32(offset, 0x666d7420, false); offset += 4; // "fmt "
            view.setUint32(offset, 16, true); offset += 4; // chunk size
            view.setUint16(offset, 1, true); offset += 2; // format (1 = PCM)
            view.setUint16(offset, numChannels, true); offset += 2; // channels
            view.setUint32(offset, sampleRate, true); offset += 4; // sample rate
            view.setUint32(offset, byteRate, true); offset += 4; // byte rate
            view.setUint16(offset, blockAlign, true); offset += 2; // block align
            view.setUint16(offset, bytesPerSample * 8, true); offset += 2; // bits per sample

            // data chunk
            view.setUint32(offset, 0x64617461, false); offset += 4; // "data"
            view.setUint32(offset, dataSize, true); offset += 4; // data size

            // write PCM data
            for (let i = 0; i < numSamples; i++) {
                view.setInt16(offset, pcm16[i], true);
                offset += 2;
            }

            return new Blob([buffer], { type: 'audio/wav' });
        }

        async function speak(text) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=`;
            const payload = {
                contents: [{ parts: [{ text: text }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const maxRetries = 5;
            let currentDelay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        // Assuming a default sample rate of 16000 Hz for PCM16 audio
                        const sampleRate = 16000;
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        const audio = new Audio(audioUrl);
                        audio.play();
                        return;
                    }
                } catch (error) {
                    console.error(`TTS API failed (attempt ${i + 1}):`, error);
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, currentDelay));
                        currentDelay *= 2; // Exponential backoff
                    } else {
                        console.error('TTS failed after multiple retries.');
                    }
                }
            }
        }

        // --- Qu·∫£n l√Ω Gi·ªè h√†ng ---
        function updateCart(itemId, change) {
            const item = menuItems.find(i => i.id === itemId);
            if (!item) return;

            if (cart[itemId]) {
                cart[itemId].quantity += change;
            } else if (change > 0) {
                cart[itemId] = { item: item, quantity: 1 };
            }

            if (cart[itemId] && cart[itemId].quantity <= 0) {
                delete cart[itemId];
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            renderApp();
        }

        // --- Qu·∫£n l√Ω State View ---
        function setView(viewName) {
            currentView = viewName;
            renderApp();
            if (viewName !== 'login') {
                const loginForm = document.getElementById('login-form');
                if (loginForm) {
                    loginForm.reset();
                }
            }
        }

        function setCategory(categoryName) {
            currentCategory = categoryName;
            renderApp();
        }

        function toggleAdminMode() {
            if (isAdmin) {
                if (currentView === 'admin') {
                    // Chuy·ªÉn sang preview mode (xem nh∆∞ kh√°ch)
                    isPreviewMode = true;
                    currentView = 'customer';
                } else {
                    // Quay v·ªÅ admin dashboard
                    isPreviewMode = false;
                    currentView = 'admin';
                }
                renderApp();
            }
        }
        
        function formatCurrency(amount) {
            return amount.toLocaleString('vi-VN') + ' ‚Ç´';
        }

        // --- Qu·∫£n l√Ω D·ªØ li·ªáu Firebase ---
        const PUBLIC_DATA_PATH = `menuItems`; // ƒê∆°n gi·∫£n h√≥a path cho development
        const PRIVATE_SALES_PATH = `sales/${userId}`;

        function setupMenuListener() {
            if (!db) {
                console.warn("‚ùå DB ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o");
                return;
            }
            const q = query(collection(db, PUBLIC_DATA_PATH));
            console.log("üîÑ Setting up menu listener for path:", PUBLIC_DATA_PATH);

            onSnapshot(q, (snapshot) => {
                menuItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("‚úÖ Loaded menu items:", menuItems.length, "items");
                console.log("üìã Menu items:", menuItems);
                console.log("üîç Raw snapshot:", snapshot.docs.map(doc => ({ id: doc.id, data: doc.data() })));
                renderApp();
            }, (error) => {
                console.error("‚ùå L·ªói khi nghe thay ƒë·ªïi menu:", error);
                console.error("‚ùå Error details:", error.code, error.message);
                // Fallback: th·ª≠ load m·ªôt l·∫ßn
                loadMenuItemsOnce();
            });
        }

        async function loadMenuItemsOnce() {
            try {
                console.log("üîÑ Loading menu items once...");
                const querySnapshot = await getDocs(collection(db, PUBLIC_DATA_PATH));
                menuItems = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("‚úÖ Loaded menu items (once):", menuItems.length, "items");
                renderApp();
            } catch (error) {
                console.error("‚ùå Failed to load menu items:", error);
            }
        }
        
        async function saveItem(item) {
            const isNew = !item.id;

            try {
                let imageUrl = item.imageUrl;

                // Handle file upload - Convert to Data URL
                const fileInput = document.getElementById('admin-form-image-file');
                if (fileInput && fileInput.files && fileInput.files[0]) {
                    console.log("üì∏ Processing image...");
                    showMessage("ƒêang x·ª≠ l√Ω ·∫£nh...", "info");
                    
                    try {
                        imageUrl = await uploadImage(fileInput.files[0]);
                        showMessage("‚úÖ ·∫¢nh ƒë√£ s·∫µn s√†ng!", "success");
                        console.log("‚úÖ Image ready for save");
                    } catch (error) {
                        showMessage("‚ùå L·ªói x·ª≠ l√Ω ·∫£nh: " + error.message, "error");
                        throw error;
                    }
                }

                // Fallback to placeholder if no image provided
                if (!imageUrl || imageUrl.trim() === '') {
                    imageUrl = `https://via.placeholder.com/400x300/f0d48f/8b542f?text=${encodeURIComponent(item.name.substring(0, 10))}`;
                    console.log("üìù Using placeholder image");
                }

                const itemToSave = {
                    name: item.name,
                    description: item.description,
                    price: parseFloat(item.price),
                    category: item.category,
                    status: item.status || 'active',
                    imageUrl: imageUrl,
                    updatedAt: new Date(),
                };

                if (isNew) {
                    await addDoc(collection(db, PUBLIC_DATA_PATH), itemToSave);
                    console.log("Th√™m m√≥n th√†nh c√¥ng");
                    showMessage("Th√™m m√≥n th√†nh c√¥ng!", "success");
                } else {
                    const itemRef = doc(db, PUBLIC_DATA_PATH, item.id);
                    await updateDoc(itemRef, itemToSave);
                    console.log("C·∫≠p nh·∫≠t m√≥n th√†nh c√¥ng");
                    showMessage("C·∫≠p nh·∫≠t m√≥n th√†nh c√¥ng!", "success");
                }

                // Clear file input
                if (fileInput) fileInput.value = '';

                setView('admin'); // Tr·ªü v·ªÅ trang qu·∫£n l√Ω
            } catch (e) {
                console.error("L·ªói khi l∆∞u m√≥n:", e);
                showMessage("L·ªói khi l∆∞u m√≥n: " + e.message, "error");
            }
        }
        
        async function deleteItem(id) {
            if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√≥n n√†y?")) return;
            try {
                await deleteDoc(doc(db, PUBLIC_DATA_PATH, id));
                console.log("‚úÖ X√≥a m√≥n th√†nh c√¥ng");
                showMessage("X√≥a m√≥n th√†nh c√¥ng!", "success");
            } catch (e) {
                console.error("‚ùå L·ªói khi x√≥a m√≥n:", e);
                showMessage("L·ªói khi x√≥a m√≥n: " + e.message, "error");
            }
        }

        // Convert image to Base64 Data URL (l∆∞u tr·ª±c ti·∫øp trong database)
        async function uploadImage(file) {
            if (!file) return null;

            try {
                console.log("üì∏ Converting image to Data URL...");
                console.log("üìÅ File:", file.name, "Size:", (file.size / 1024).toFixed(2), "KB");

                // Check file size (max 1MB recommended for Data URL)
                if (file.size > 1024 * 1024) {
                    throw new Error("·∫¢nh qu√° l·ªõn! Vui l√≤ng ch·ªçn ·∫£nh nh·ªè h∆°n 1MB");
                }

                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const dataURL = e.target.result;
                        console.log("‚úÖ Image converted successfully!");
                        console.log("üìä Data URL length:", dataURL.length);
                        resolve(dataURL);
                    };
                    
                    reader.onerror = function(error) {
                        console.error("‚ùå Error reading file:", error);
                        reject(error);
                    };
                    
                    reader.readAsDataURL(file);
                });
            } catch (error) {
                console.error("‚ùå Error processing image:", error);
                throw error;
            }
        }

        // Thay ƒë·ªïi m·∫≠t kh·∫©u
        async function changePassword(currentPassword, newPassword) {
            try {
                const user = auth.currentUser;
                if (!user) throw new Error("Kh√¥ng c√≥ user ƒëƒÉng nh·∫≠p");

                // Re-authenticate v·ªõi password hi·ªán t·∫°i
                const credential = EmailAuthProvider.credential(user.email, currentPassword);
                await reauthenticateWithCredential(user, credential);

                // Update password m·ªõi
                await updatePassword(user, newPassword);
                console.log("Password changed successfully");

                showMessage("ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!", "success");
                return true;
            } catch (error) {
                console.error("Error changing password:", error);
                let errorMessage = "L·ªói khi ƒë·ªïi m·∫≠t kh·∫©u";

                if (error.code === 'auth/wrong-password') {
                    errorMessage = "M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "M·∫≠t kh·∫©u m·ªõi qu√° y·∫øu";
                }

                showMessage(errorMessage, "error");
                return false;
            }
        }

        // --- Qu·∫£n l√Ω ƒêƒÉng nh·∫≠p/ƒêƒÉng xu·∫•t ---
        async function handleLogin(e) {
            e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;

            console.log("üîê Attempting login with email:", email);

            try {
                showMessage("ƒêang ƒëƒÉng nh·∫≠p...", "info");
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                
                console.log("‚úÖ Login successful!");
                console.log("üë§ User:", userCredential.user.email);
                console.log("üÜî UID:", userCredential.user.uid);
                
                // Check if admin
                const adminEmails = ['binhbiinshop@admin.com', 'duong3112@gmail.com'];
                const isAdminUser = adminEmails.includes(userCredential.user.email);
                
                console.log("üëë Is Admin:", isAdminUser);
                
                if (isAdminUser) {
                    showMessage("‚úÖ ƒêƒÉng nh·∫≠p Admin th√†nh c√¥ng! Chuy·ªÉn ƒë·∫øn Dashboard...", "success");
                    console.log("üöÄ Redirecting to Admin Dashboard");
                } else {
                    showMessage("‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Nh∆∞ng t√†i kho·∫£n kh√¥ng c√≥ quy·ªÅn Admin.", "info");
                    console.log("‚ö†Ô∏è User is not admin, staying in customer view");
                }
                
                // AuthStateChanged s·∫Ω lo vi·ªác chuy·ªÉn view
            } catch (error) {
                console.error("‚ùå Login failed:", error.code, error.message);
                let errorMessage = "ƒêƒÉng nh·∫≠p th·∫•t b·∫°i.";

                if (error.code === 'auth/user-not-found') {
                    errorMessage = "‚ùå T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i.";
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = "‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "‚ùå Email kh√¥ng h·ª£p l·ªá.";
                } else if (error.code === 'auth/invalid-credential') {
                    errorMessage = "‚ùå Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.";
                }

                document.getElementById('login-message').textContent = errorMessage;
                showMessage(errorMessage, "error");
                console.log("‚ùå Error details:", error);
            }
        }
        
        async function handleLogout() {
            try {
                console.log("üîì Logging out...");
                await signOut(auth);
                console.log("‚úÖ Logout successful");
                showMessage("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!", "success");
                isPreviewMode = false;
                // AuthStateChanged s·∫Ω lo vi·ªác chuy·ªÉn view
            } catch (error) {
                console.error("‚ùå Logout error:", error);
                showMessage("L·ªói khi ƒëƒÉng xu·∫•t", "error");
            }
        }

        // --- Kh·ªüi t·∫°o v√† Qu·∫£n l√Ω Auth ---
        function initFirebase() {
            try {
                console.log("üöÄ Initializing Firebase with config:", firebaseConfig);
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);
                    storage = getStorage(app);
                    console.log("‚úÖ Firebase initialized successfully");
                } else {
                    console.warn("‚ùå Firebase Config kh√¥ng t·ªìn t·∫°i. D√πng ch·∫ø ƒë·ªô Demo.");
                }

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        // Check if user is admin (multiple admin emails supported)
                        const adminEmails = ['binhbiinshop@admin.com', 'duong3112@gmail.com'];
                        isAdmin = adminEmails.includes(user.email);
                        
                        console.log("üë§ User authenticated:", user.email);
                        console.log("üëë Is Admin:", isAdmin);
                        
                        if (__initial_auth_token && user.isAnonymous) {
                            // ƒê√¢y l√† logic ƒë·∫∑c bi·ªát cho m√¥i tr∆∞·ªùng Canvas, d√πng token ban ƒë·∫ßu
                            await signInWithCustomToken(auth, __initial_auth_token);
                            // Sau khi ƒëƒÉng nh·∫≠p b·∫±ng custom token, user v·∫´n l√† ·∫©n danh.
                            userId = auth.currentUser.uid;
                            isAdmin = false;
                        }
                        
                        if (db) setupMenuListener();
                        
                        // Chuy·ªÉn v·ªÅ tr·∫°ng th√°i Kh√°ch h√†ng n·∫øu kh√¥ng ph·∫£i Admin
                        if (isAdmin && currentView === 'login') {
                           console.log("üöÄ Switching to Admin Dashboard");
                           setView('admin');
                           showMessage("Ch√†o m·ª´ng Admin! üëë", "success");
                        } else if (!isAdmin && currentView === 'login') {
                           console.log("üë§ Switching to Customer view");
                           setView('customer');
                        }
                    } else {
                        // User ƒë√£ ƒëƒÉng xu·∫•t
                        isAdmin = false;
                        userId = crypto.randomUUID(); // D√πng ID ng·∫´u nhi√™n cho kh√°ch ·∫©n danh
                        if (db) {
                            // T·∫°m th·ªùi b·ªè anonymous auth ƒë·ªÉ tr√°nh l·ªói config
                            // if (!__initial_auth_token) await signInAnonymously(auth);
                            console.log("üîÑ Setting up menu listener without auth...");
                            setupMenuListener();
                        }
                        setView('customer');
                    }
                    renderApp();
                });
            } catch (e) {
                console.error("L·ªói kh·ªüi t·∫°o Firebase:", e);
            }
        }


        // --- Render UI ---
        function renderHeader() {
            const loginButton = isAdmin
                ? `<button onclick="handleLogout()" class="px-4 py-2 rounded-full bg-red-600 text-white hover:bg-red-700 transition duration-150 flex items-center space-x-2">
                    <i data-lucide="log-out" class="w-4 h-4"></i>
                    <span>ƒêƒÉng Xu·∫•t</span>
                </button>`
                : `<button onclick="setView('login')" class="px-4 py-2 rounded-full bg-orange-600 text-white hover:bg-orange-700 transition duration-150">ƒêƒÉng Nh·∫≠p Admin</button>`;

            const adminToggle = isAdmin 
                ? `<button onclick="toggleAdminMode()" class="flex items-center space-x-2 px-4 py-2 rounded-full ${currentView === 'admin' ? 'bg-blue-500 hover:bg-blue-600' : 'bg-yellow-500 hover:bg-yellow-600'} text-white font-semibold transition duration-150">
                    <i data-lucide="${currentView === 'admin' ? 'eye' : 'settings'}" class="w-5 h-5"></i>
                    <span>${currentView === 'admin' ? 'üëÅÔ∏è Xem Trang Kh√°ch' : 'üëë Qu·∫£n L√Ω Admin'}</span>
                </button>` : '';
            
            const adminBadge = isAdmin && !isPreviewMode
                ? `<span class="px-3 py-1 bg-red-500 text-white text-xs font-bold rounded-full">üëë ADMIN</span>`
                : isPreviewMode
                ? `<span class="px-3 py-1 bg-blue-500 text-white text-xs font-bold rounded-full">üëÅÔ∏è PREVIEW</span>`
                : '';
            
            // ·∫®n gi·ªè h√†ng khi admin ·ªü mode admin (kh√¥ng preview)
            const cartButton = (isAdmin && !isPreviewMode) ? '' : `
                <button onclick="document.getElementById('cart-sidebar').classList.remove('translate-x-full')" class="relative p-2 rounded-full bg-orange-500 text-white hover:bg-orange-600 transition duration-150 shadow-md">
                    <i data-lucide="shopping-cart" class="w-6 h-6"></i>
                    ${Object.keys(cart).length > 0 ? `<span class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">${Object.values(cart).reduce((sum, item) => sum + item.quantity, 0)}</span>` : ''}
                </button>
            `;

            return `
                <header class="sticky top-0 z-20 bg-amber-100/90 backdrop-blur-sm shadow-md border-b border-yellow-700/50">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                        <!-- Logo Qu√°n -->
                        <div class="flex items-center space-x-3">
                            <i data-lucide="coffee" class="text-amber-800 w-8 h-8"></i>
                            <h1 class="text-2xl font-bold text-amber-900 font-serif">Qu√°n Tr√† ƒê·ªì</h1>
                        </div>
                        
                        <!-- Li√™n h·ªá & ƒêƒÉng nh·∫≠p -->
                        <div class="flex items-center space-x-4">
                            ${adminBadge}
                            ${adminToggle}
                            <a href="#" class="text-amber-800 hover:text-orange-600 transition duration-150 hidden sm:block">
                                <i data-lucide="phone" class="w-5 h-5 inline mr-1"></i> Li√™n H·ªá
                            </a>
                            ${loginButton}
                            ${cartButton}
                        </div>
                    </div>
                </header>
            `;
        }

        function renderMenuSelection() {
            return `
                <div class="flex justify-center space-x-2 p-4 bg-amber-50 shadow-inner sticky top-[68px] z-10">
                    ${categories.map(cat => `
                        <button onclick="setCategory('${cat}')" class="${currentCategory === cat ? 'bg-orange-600 text-white shadow-lg' : 'bg-white text-amber-900 hover:bg-amber-200'} font-semibold py-2 px-6 rounded-full transition duration-150">
                            ${cat}
                        </button>
                    `).join('')}
                </div>
            `;
        }
        
        function renderCustomerMenu() {
            const filteredItems = menuItems.filter(item => {
                // ·∫®n m√≥n ƒë√£ x√≥a cho kh√°ch h√†ng
                if (!isAdmin && item.status === 'deleted') return false;
                return item.category === currentCategory;
            });
            
            // Ki·ªÉm tra xem c√≥ ph·∫£i admin ƒëang ·ªü mode admin kh√¥ng (·∫©n n√∫t +)
            const showAddButton = !isAdmin || isPreviewMode;
            
            if (currentCategory === 'ƒê·ªì U·ªëng') {
                // Layout ƒê·ªì U·ªëng: 1 m√≥n/h√†ng, ·∫£nh tr√°i
                return filteredItems.map(item => {
                    const statusBadge = getStatusBadge(item.status);
                    const isOutOfStock = item.status === 'out_of_stock';
                    
                    return `
                    <div class="flex items-center bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300 p-4 border border-amber-200 ${isOutOfStock ? 'opacity-60' : ''}">
                        <img src="${item.imageUrl}" alt="${item.name}" class="w-24 h-24 object-cover rounded-lg mr-4 flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/96x96/f0d48f/8b542f?text=N∆∞·ªõc'">
                        <div class="flex-grow">
                            <div class="flex items-center gap-2">
                                <h3 class="text-lg font-semibold text-amber-900">${item.name} ${item.size ? `<span class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">${item.size}</span>` : ''}</h3>
                                ${statusBadge}
                            </div>
                            <p class="text-sm text-gray-500 mb-2">${item.description}</p>
                            <div class="flex items-center gap-2">
                                ${item.newPrice ?
                                    `<span class="text-lg text-gray-500 line-through">${formatCurrency(item.price)}</span>
                                     <span class="text-xl font-bold text-red-600">${formatCurrency(item.newPrice)}</span>` :
                                    `<span class="text-xl font-bold text-orange-600">${formatCurrency(item.price)}</span>`
                                }
                                ${isAdmin && !isPreviewMode ? `<button onclick="openPriceModal('${item.id}')" class="ml-2 px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600">üí∞</button>` : ''}
                            </div>
                        </div>
                        ${showAddButton && !isOutOfStock ? `
                            <button onclick="updateCart('${item.id}', 1)" class="p-3 bg-orange-500 text-white rounded-full hover:bg-orange-600 transition duration-150 flex-shrink-0 shadow-md">
                                <i data-lucide="plus" class="w-6 h-6"></i>
                            </button>
                        ` : ''}
                    </div>
                `}).join('');
            } else {
                // Layout ƒê·ªì ƒÇn/ƒê·ªì Nh·∫≠u: 2 m√≥n/h√†ng, khung vu√¥ng
                return `
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 p-4 sm:p-6">
                        ${filteredItems.map(item => {
                            const statusBadge = getStatusBadge(item.status);
                            const isOutOfStock = item.status === 'out_of_stock';
                            
                            return `
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-amber-300 flex flex-col hover:shadow-xl transition duration-300 ${isOutOfStock ? 'opacity-60' : ''}">
                                <div class="relative">
                                    <img src="${item.imageUrl}" alt="${item.name}" class="w-full h-32 sm:h-40 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x160/f0d48f/8b542f?text=M√≥n+ƒÇn'">
                                    <div class="absolute top-2 right-2">
                                        ${statusBadge}
                                    </div>
                                </div>
                                <div class="p-4 flex flex-col flex-grow">
                                    <h3 class="text-lg font-bold text-amber-900 mb-1">${item.name} ${item.size ? `<span class="text-sm bg-blue-100 text-blue-800 px-1 py-0.5 rounded ml-1">${item.size}</span>` : ''}</h3>
                                    <p class="text-xs text-gray-500 line-clamp-2 mb-3">${item.description}</p>
                                    <div class="mt-auto flex justify-between items-center">
                                        <div class="flex items-center gap-2">
                                            ${item.newPrice ?
                                                `<span class="text-lg text-gray-500 line-through">${formatCurrency(item.price)}</span>
                                                 <span class="text-xl font-bold text-red-600">${formatCurrency(item.newPrice)}</span>` :
                                                `<span class="text-xl font-bold text-orange-600">${formatCurrency(item.price)}</span>`
                                            }
                                            ${isAdmin && !isPreviewMode ? `<button onclick="openPriceModal('${item.id}')" class="ml-1 px-1 py-0.5 text-xs bg-blue-500 text-white rounded hover:bg-blue-600">üí∞</button>` : ''}
                                        </div>
                                        ${showAddButton && !isOutOfStock ? `
                                            <button onclick="updateCart('${item.id}', 1)" class="p-2 bg-orange-500 text-white rounded-full hover:bg-orange-600 transition duration-150 shadow-md">
                                                <i data-lucide="plus" class="w-5 h-5"></i>
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                `;
            }
        }

        function getStatusBadge(status) {
            if (!status || status === 'active') return '';

            const badges = {
                'hot': '<span class="px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-full">üî• B√ÅN CH·∫†Y</span>',
                'new': '<span class="px-2 py-1 bg-green-500 text-white text-xs font-bold rounded-full">üÜï M·ªöI</span>',
                'sale': '<span class="px-2 py-1 bg-purple-500 text-white text-xs font-bold rounded-full">üí∞ SALE</span>',
                'best_seller': '<span class="px-2 py-1 bg-yellow-500 text-black text-xs font-bold rounded-full">‚≠ê BEST SELLER</span>',
                'out_of_stock': '<span class="px-2 py-1 bg-gray-500 text-white text-xs font-bold rounded-full">‚ùå H·∫æT H√ÄNG</span>',
                'coming_soon': '<span class="px-2 py-1 bg-blue-500 text-white text-xs font-bold rounded-full">‚è≥ S·∫ÆP C√ì</span>',
                'deleted': '<span class="px-2 py-1 bg-black text-white text-xs font-bold rounded-full">üóëÔ∏è ƒê√É X√ìA</span>'
            };

            return badges[status] || '';
        }

        function getCategoryIcon(category) {
            const icons = {
                'ƒê·ªì U·ªëng': '‚òï',
                'ƒê·ªì ƒÇn': 'üçΩÔ∏è',
                'ƒê·ªì Nh·∫≠u': 'üç∫'
            };
            return icons[category] || 'üìÇ';
        }

        // Category Management Functions
        let editingCategory = null;

        function editCategory(categoryName) {
            editingCategory = categoryName;
            document.getElementById('new-category-name').value = categoryName;
            document.getElementById('category-modal').classList.remove('hidden');
            document.getElementById('category-modal').querySelector('h3').textContent = '‚úèÔ∏è S·ª≠a Danh M·ª•c';
            document.querySelector('button[onclick="addNewCategory()"]').textContent = 'C·∫≠p Nh·∫≠t';
            document.querySelector('button[onclick="addNewCategory()"]').onclick = () => updateCategory();
        }

        function updateCategory() {
            const newName = document.getElementById('new-category-name').value.trim();
            if (!newName) {
                showMessage("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c!", "error");
                return;
            }

            if (newName !== editingCategory && categories.includes(newName)) {
                showMessage("Danh m·ª•c n√†y ƒë√£ t·ªìn t·∫°i!", "error");
                return;
            }

            const index = categories.indexOf(editingCategory);
            if (index > -1) {
                categories[index] = newName;

                // Update all items in this category
                menuItems.forEach(item => {
                    if (item.category === editingCategory) {
                        // Update in Firestore
                        updateDoc(doc(db, PUBLIC_DATA_PATH, item.id), {
                            category: newName,
                            updatedAt: new Date()
                        });
                    }
                });

                showMessage(`ƒê√£ c·∫≠p nh·∫≠t danh m·ª•c: ${editingCategory} ‚Üí ${newName}`, "success");
                closeCategoryModal();
                renderApp();
            }
        }

        function deleteCategory(categoryName) {
            const index = categories.indexOf(categoryName);
            if (index < 3) {
                showMessage("Kh√¥ng th·ªÉ x√≥a 3 danh m·ª•c m·∫∑c ƒë·ªãnh!", "error");
                return;
            }

            const itemsInCategory = menuItems.filter(item => item.category === categoryName);
            if (itemsInCategory.length > 0) {
                const confirmDelete = confirm(`Danh m·ª•c "${categoryName}" c√≥ ${itemsInCategory.length} m√≥n. B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?\n\nT·∫•t c·∫£ m√≥n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn sang "ƒê·ªì ƒÇn".`);
                if (!confirmDelete) return;

                // Move items to default category
                itemsInCategory.forEach(item => {
                    updateDoc(doc(db, PUBLIC_DATA_PATH, item.id), {
                        category: 'ƒê·ªì ƒÇn',
                        updatedAt: new Date()
                    });
                });
            }

            categories.splice(index, 1);
            showMessage(`ƒê√£ x√≥a danh m·ª•c: ${categoryName}`, "success");
            renderApp();
        }

        // Price Update Modal
        let currentPriceUpdateItem = null;

        function openPriceModal(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (!item) return;

            currentPriceUpdateItem = item;

            const modalContent = document.getElementById('price-modal-content');
            const oldPrice = item.price;
            const newPrice = item.newPrice || '';

            modalContent.innerHTML = `
                <div class="mb-4">
                    <h4 class="font-semibold text-amber-900 mb-2">${item.name}</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gi√° Hi·ªán T·∫°i</label>
                            <div class="text-lg font-bold text-gray-600 ${newPrice ? 'line-through' : ''}">
                                ${formatCurrency(oldPrice)}
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gi√° M·ªõi (C√≥ Th·ªÉ B·ªè Tr·ªëng)</label>
                            <input type="number" id="new-price-input" value="${newPrice}" placeholder="Nh·∫≠p gi√° m·ªõi..."
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                        </div>

                        ${newPrice ? `
                            <div class="p-3 bg-green-50 rounded-lg">
                                <div class="text-sm text-green-800">
                                    <strong>Gi√° m·ªõi:</strong> ${formatCurrency(parseFloat(newPrice))}
                                    ${parseFloat(newPrice) > oldPrice ? 'üìà (TƒÉng)' : parseFloat(newPrice) < oldPrice ? 'üìâ (Gi·∫£m)' : '‚û°Ô∏è (Gi·ªØ nguy√™n)'}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.getElementById('price-modal').classList.remove('hidden');
        }

        function closePriceModal() {
            document.getElementById('price-modal').classList.add('hidden');
            currentPriceUpdateItem = null;
        }

        async function savePriceUpdate() {
            if (!currentPriceUpdateItem) return;

            const newPriceInput = document.getElementById('new-price-input');
            const newPriceValue = newPriceInput.value.trim();

            try {
                const updateData = {
                    name: currentPriceUpdateItem.name,
                    description: currentPriceUpdateItem.description,
                    price: currentPriceUpdateItem.price,
                    category: currentPriceUpdateItem.category,
                    status: currentPriceUpdateItem.status,
                    imageUrl: currentPriceUpdateItem.imageUrl,
                    updatedAt: new Date()
                };

                // Only add size if it exists and is not null/undefined
                if (currentPriceUpdateItem.size && currentPriceUpdateItem.size.trim() !== '') {
                    updateData.size = currentPriceUpdateItem.size;
                }

                if (newPriceValue === '') {
                    // X√≥a gi√° m·ªõi, ch·ªâ gi·ªØ gi√° c≈© (Firestore s·∫Ω x√≥a field n·∫øu kh√¥ng c√≥ trong update)
                } else {
                    // C·∫≠p nh·∫≠t gi√° m·ªõi
                    const newPriceNum = parseFloat(newPriceValue);
                    if (newPriceNum <= 0) {
                        showMessage("Gi√° ph·∫£i l·ªõn h∆°n 0!", "error");
                        return;
                    }
                    updateData.newPrice = newPriceNum;
                }

                // Filter out undefined values to prevent Firestore errors
                Object.keys(updateData).forEach(key => {
                    if (updateData[key] === undefined) {
                        delete updateData[key];
                    }
                });

                await updateDoc(doc(db, PUBLIC_DATA_PATH, currentPriceUpdateItem.id), updateData);
                showMessage("C·∫≠p nh·∫≠t gi√° th√†nh c√¥ng!", "success");

                closePriceModal();
                // Refresh data
                loadMenuItemsOnce();

            } catch (error) {
                console.error("Error updating price:", error);
                showMessage("L·ªói khi c·∫≠p nh·∫≠t gi√°: " + error.message, "error");
            }
        }

        // Category Management
        function openCategoryModal() {
            document.getElementById('category-modal').classList.remove('hidden');
            document.getElementById('new-category-name').focus();
        }

        function closeCategoryModal() {
            document.getElementById('category-modal').classList.add('hidden');
            document.getElementById('new-category-name').value = '';
            resetCategoryModal();
        }

        function addNewCategory() {
            const categoryName = document.getElementById('new-category-name').value.trim();
            if (!categoryName) {
                showMessage("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c!", "error");
                return;
            }

            if (categories.includes(categoryName)) {
                showMessage("Danh m·ª•c n√†y ƒë√£ t·ªìn t·∫°i!", "error");
                return;
            }

            categories.push(categoryName);
            showMessage(`ƒê√£ th√™m danh m·ª•c: ${categoryName}`, "success");
            closeCategoryModal();
            renderApp(); // Re-render ƒë·ªÉ c·∫≠p nh·∫≠t menu selection
        }

        function resetCategoryModal() {
            editingCategory = null;
            document.getElementById('category-modal').querySelector('h3').textContent = '‚ûï Th√™m Danh M·ª•c M·ªõi';
            document.querySelector('button[onclick*="addNewCategory"]').textContent = 'Th√™m';
            document.querySelector('button[onclick*="addNewCategory"]').onclick = () => addNewCategory();
        }
        
        function renderLoginView() {
            return `
                <div class="flex justify-center items-center py-20 bg-amber-50 min-h-screen">
                    <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl border border-yellow-700/50">
                        <h2 class="text-3xl font-bold text-center text-amber-900 mb-6">üëë ƒêƒÉng Nh·∫≠p Admin</h2>
                        <form id="login-form" onsubmit="handleLogin(event)">
                            <div class="mb-4">
                                <label for="email" class="block text-amber-800 font-semibold mb-2">Email Admin</label>
                                <input type="email" id="email" name="email" required class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-150" placeholder="binhbiinshop@admin.com">
                            </div>
                            <div class="mb-6">
                                <label for="password" class="block text-amber-800 font-semibold mb-2">M·∫≠t kh·∫©u</label>
                                <input type="password" id="password" name="password" required class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-150" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <p id="login-message" class="text-red-500 text-sm mb-4"></p>
                            <button type="submit" class="w-full bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition duration-150 shadow-lg">ƒêƒÉng Nh·∫≠p</button>
                        </form>
                        <p class="mt-4 text-center text-sm text-gray-500">
                            (Ch·ªâ d√†nh cho Qu·∫£n tr·ªã vi√™n)
                        </p>
                        <button onclick="setView('customer')" class="w-full mt-4 text-orange-600 hover:text-orange-800 transition duration-150 text-sm">
                            Tr·ªü v·ªÅ trang kh√°ch h√†ng
                        </button>
                    </div>
                </div>
            `;
        }
        
        function renderAdminDashboard() {
            const totalRevenue = 15000000; // Mock data
            const totalOrders = 120; // Mock data
            
            const itemToEdit = menuItems.find(i => i.id === (document.getElementById('admin-form-id')?.value || null));

            return `
                <div class="p-6 md:p-10 bg-gray-50 min-h-screen">
                    <h2 class="text-3xl font-bold text-amber-900 mb-6">B·∫£ng ƒêi·ªÅu Khi·ªÉn Qu·∫£n Tr·ªã (Admin)</h2>
                    
                    <!-- Th·ªëng k√™ doanh thu th√°ng (Mock) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-orange-500">
                            <p class="text-sm text-gray-500">Doanh Thu Th√°ng (Mock)</p>
                            <p class="text-3xl font-extrabold text-amber-900 mt-1">${formatCurrency(totalRevenue)}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-500">
                            <p class="text-sm text-gray-500">T·ªïng ƒê∆°n H√†ng (Mock)</p>
                            <p class="text-3xl font-extrabold text-amber-900 mt-1">${totalOrders}</p>
                        </div>
                         <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-amber-500">
                            <p class="text-sm text-gray-500">S·ªë M√≥n ƒêang B√°n</p>
                            <p class="text-3xl font-extrabold text-amber-900 mt-1">${menuItems.length}</p>
                        </div>
                    </div>

                    <!-- Ph·∫ßn Thay ƒë·ªïi M·∫≠t kh·∫©u -->
                    <div class="bg-blue-50 p-6 rounded-xl shadow-lg mb-8">
                        <h3 class="text-2xl font-bold text-blue-600 mb-4">üîê Thay ƒë·ªïi M·∫≠t kh·∫©u</h3>
                        <form id="change-password-form" onsubmit="event.preventDefault(); handleChangePassword()">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                                    <input type="password" id="current-password" required class="mt-1 block w-full rounded-md border-blue-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">M·∫≠t kh·∫©u m·ªõi</label>
                                    <input type="password" id="new-password" required minlength="6" class="mt-1 block w-full rounded-md border-blue-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                                    <input type="password" id="confirm-password" required minlength="6" class="mt-1 block w-full rounded-md border-blue-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                </div>
                            </div>
                            <div class="mt-4">
                                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md shadow-lg text-sm font-medium hover:bg-blue-700">
                                    üîÑ ƒê·ªïi M·∫≠t kh·∫©u
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Ph·∫ßn Qu·∫£n L√Ω Danh M·ª•c -->
                    <div class="bg-indigo-50 p-6 rounded-xl shadow-lg mb-8">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-4">üìÇ Qu·∫£n L√Ω Danh M·ª•c</h3>

                        <div class="mb-4">
                            <button onclick="openCategoryModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 flex items-center gap-2">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                Th√™m Danh M·ª•c M·ªõi
                            </button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${categories.map((cat, index) => `
                                <div class="bg-white p-4 rounded-lg border border-indigo-200 flex justify-between items-center">
                                    <div class="flex items-center gap-2">
                                        <span class="text-lg">${getCategoryIcon(cat)}</span>
                                        <span class="font-medium text-gray-800">${cat}</span>
                                        <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full">
                                            ${menuItems.filter(item => item.category === cat && item.status !== 'deleted').length} m√≥n
                                        </span>
                                    </div>
                                    ${index >= 3 ? `
                                        <div class="flex gap-1">
                                            <button onclick="editCategory('${cat}')" class="text-blue-600 hover:text-blue-800 p-1" title="S·ª≠a">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button onclick="deleteCategory('${cat}')" class="text-red-600 hover:text-red-800 p-1" title="X√≥a">
                                                <i data-lucide="trash" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>

                        <div class="mt-4 text-sm text-gray-600">
                            <strong>L∆∞u √Ω:</strong> 3 danh m·ª•c ƒë·∫ßu ti√™n (ƒê·ªì U·ªëng, ƒê·ªì ƒÇn, ƒê·ªì Nh·∫≠u) kh√¥ng th·ªÉ x√≥a. C√°c danh m·ª•c kh√°c c√≥ th·ªÉ s·ª≠a/x√≥a.
                        </div>
                    </div>

                    <!-- Ph·∫ßn Qu·∫£n l√Ω M√≥n ƒÉn -->
                    <div class="bg-white p-6 rounded-xl shadow-2xl mb-8">
                        <h3 class="text-2xl font-bold text-orange-600 mb-4">${itemToEdit ? 'Ch·ªânh S·ª≠a M√≥n' : 'Th√™m M√≥n M·ªõi'}</h3>
                        <form id="admin-item-form" onsubmit="event.preventDefault(); handleSaveItem()">
                            <input type="hidden" id="admin-form-id" value="${itemToEdit ? itemToEdit.id : ''}">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">T√™n M√≥n</label>
                                    <input type="text" id="admin-form-name" required value="${itemToEdit ? itemToEdit.name : ''}" class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Gi√° (VNƒê)</label>
                                    <input type="number" id="admin-form-price" required value="${itemToEdit ? itemToEdit.price : ''}" class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Danh M·ª•c</label>
                                    <select id="admin-form-category" required class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                        <option value="ƒê·ªì U·ªëng" ${itemToEdit && itemToEdit.category === 'ƒê·ªì U·ªëng' ? 'selected' : ''}>ƒê·ªì U·ªëng</option>
                                        <option value="ƒê·ªì ƒÇn" ${itemToEdit && itemToEdit.category === 'ƒê·ªì ƒÇn' ? 'selected' : ''}>ƒê·ªì ƒÇn</option>
                                        <option value="ƒê·ªì Nh·∫≠u" ${itemToEdit && itemToEdit.category === 'ƒê·ªì Nh·∫≠u' ? 'selected' : ''}>ƒê·ªì Nh·∫≠u</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Tr·∫°ng Th√°i</label>
                                    <select id="admin-form-status" class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                        <option value="active" ${!itemToEdit || itemToEdit.status === 'active' ? 'selected' : ''}>‚úÖ ƒêang b√°n</option>
                                        <option value="hot" ${itemToEdit && itemToEdit.status === 'hot' ? 'selected' : ''}>üî• B√°n ch·∫°y</option>
                                        <option value="new" ${itemToEdit && itemToEdit.status === 'new' ? 'selected' : ''}>üÜï M√≥n m·ªõi</option>
                                        <option value="sale" ${itemToEdit && itemToEdit.status === 'sale' ? 'selected' : ''}>üí∞ Sale</option>
                                        <option value="best_seller" ${itemToEdit && itemToEdit.status === 'best_seller' ? 'selected' : ''}>‚≠ê Best Seller</option>
                                        <option value="out_of_stock" ${itemToEdit && itemToEdit.status === 'out_of_stock' ? 'selected' : ''}>‚ùå H·∫øt h√†ng</option>
                                        <option value="coming_soon" ${itemToEdit && itemToEdit.status === 'coming_soon' ? 'selected' : ''}>‚è≥ S·∫Øp c√≥</option>
                                        <option value="deleted" ${itemToEdit && itemToEdit.status === 'deleted' ? 'selected' : ''}>üóëÔ∏è ƒê√£ x√≥a</option>
                                    </select>
                                </div>

                                <div id="size-field" style="display: ${itemToEdit && itemToEdit.category === 'ƒê·ªì U·ªëng' ? 'block' : 'none'};">
                                    <label class="block text-sm font-medium text-gray-700">Size (ƒê·ªì U·ªëng)</label>
                                    <select id="admin-form-size" class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                        <option value="" ${!itemToEdit || !itemToEdit.size ? 'selected' : ''}>Kh√¥ng ch·ªçn size</option>
                                        ${drinkSizes.map(size => `<option value="${size}" ${itemToEdit && itemToEdit.size === size ? 'selected' : ''}>${size}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">·∫¢nh</label>
                                    <input type="file" id="admin-form-image-file" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                                    <p class="mt-1 text-xs text-gray-500">Ho·∫∑c nh·∫≠p URL tr·ª±c ti·∫øp:</p>
                                    <input type="url" id="admin-form-image" value="${itemToEdit ? itemToEdit.imageUrl : ''}" placeholder="https://..." class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-sm font-medium text-gray-700">M√¥ T·∫£</label>
                                <textarea id="admin-form-description" rows="2" class="mt-1 block w-full rounded-md border-amber-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">${itemToEdit ? itemToEdit.description : ''}</textarea>
                            </div>
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" onclick="clearAdminForm()" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50">H·ªßy/Th√™m M·ªõi</button>
                                <button type="submit" class="px-4 py-2 bg-orange-600 text-white rounded-md shadow-lg text-sm font-medium hover:bg-orange-700">
                                    ${itemToEdit ? 'C·∫≠p Nh·∫≠t M√≥n' : 'Th√™m M√≥n'}
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Danh s√°ch M√≥n ƒÉn -->
                    <div class="bg-white p-6 rounded-xl shadow-2xl">
                        <h3 class="text-2xl font-bold text-amber-900 mb-4">Danh S√°ch M√≥n ƒÇn/ƒê·ªì U·ªëng (${menuItems.length})</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-amber-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">T√™n M√≥n</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Danh M·ª•c</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tr·∫°ng Th√°i</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gi√°</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Thao T√°c</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${menuItems.map(item => `
                                        <tr class="${item.status === 'deleted' ? 'bg-gray-100' : ''}">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-amber-900">${item.name}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.category}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">${item.size || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm">${getStatusBadge(item.status) || '<span class="text-green-600">‚úÖ ƒêang b√°n</span>'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-orange-600 font-semibold">${formatCurrency(item.price)}${item.newPrice ? ` ‚Üí ${formatCurrency(item.newPrice)}` : ''}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                                <button onclick="loadItemForEdit('${item.id}')" class="text-indigo-600 hover:text-indigo-900">S·ª≠a</button>
                                                <button onclick="deleteItem('${item.id}')" class="text-red-600 hover:text-red-900">X√≥a</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function clearAdminForm() {
            document.getElementById('admin-item-form').reset();
            document.getElementById('admin-form-id').value = '';
            renderApp(); // Force re-render ƒë·ªÉ c·∫≠p nh·∫≠t ti√™u ƒë·ªÅ form
        }
        
        function loadItemForEdit(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (item) {
                document.getElementById('admin-form-id').value = item.id;
                document.getElementById('admin-form-name').value = item.name;
                document.getElementById('admin-form-price').value = item.price;
                document.getElementById('admin-form-category').value = item.category;
                document.getElementById('admin-form-status').value = item.status || 'active';
                document.getElementById('admin-form-size').value = item.size || '';
                document.getElementById('admin-form-image').value = item.imageUrl || '';
                document.getElementById('admin-form-description').value = item.description || '';

                // Show/hide size field based on category
                toggleSizeField(item.category);

                renderApp(); // Force re-render ƒë·ªÉ c·∫≠p nh·∫≠t ti√™u ƒë·ªÅ form
            }
        }

        function toggleSizeField(category) {
            const sizeField = document.getElementById('size-field');
            if (sizeField) {
                sizeField.style.display = category === 'ƒê·ªì U·ªëng' ? 'block' : 'none';
            }
        }

        // Add event listener for category change
        document.addEventListener('DOMContentLoaded', function() {
            const categorySelect = document.getElementById('admin-form-category');
            if (categorySelect) {
                categorySelect.addEventListener('change', function(e) {
                    toggleSizeField(e.target.value);
                });
            }
        });
        
        function handleSaveItem() {
            const item = {
                id: document.getElementById('admin-form-id').value,
                name: document.getElementById('admin-form-name').value,
                price: parseFloat(document.getElementById('admin-form-price').value),
                category: document.getElementById('admin-form-category').value,
                status: document.getElementById('admin-form-status').value,
                size: document.getElementById('admin-form-size').value || null,
                imageUrl: document.getElementById('admin-form-image').value,
                description: document.getElementById('admin-form-description').value,
            };
            saveItem(item);
        }

        async function handleChangePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword !== confirmPassword) {
                showMessage("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!", "error");
                return;
            }

            if (newPassword.length < 6) {
                showMessage("M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!", "error");
                return;
            }

            const success = await changePassword(currentPassword, newPassword);
            if (success) {
                document.getElementById('change-password-form').reset();
            }
        }


        function renderMainContent() {
            switch (currentView) {
                case 'login':
                    return renderLoginView();
                case 'admin':
                    return isAdmin ? renderAdminDashboard() : renderLoginView();
                case 'customer':
                default:
                    const menuHtml = currentCategory === 'ƒê·ªì U·ªëng' 
                        ? `<div class="max-w-7xl mx-auto p-4 md:p-6 space-y-4">${renderCustomerMenu()}</div>`
                        : `<div class="max-w-7xl mx-auto">${renderCustomerMenu()}</div>`;
                    
                    return `
                        ${renderMenuSelection()}
                        <main class="bg-amber-50">
                            ${menuHtml}
                        </main>
                    `;
            }
        }
        
        function renderCartSidebar() {
            const itemsInCart = Object.values(cart);
            const total = itemsInCart.reduce((sum, entry) => sum + (entry.item.price * entry.quantity), 0);
            const cartClasses = Object.keys(cart).length === 0 
                ? 'translate-x-full' // ·∫®n khi kh√¥ng c√≥ m√≥n
                : ''; // Gi·ªØ tr·∫°ng th√°i ·∫©n/hi·ªán d·ª±a tr√™n click

            return `
                <!-- N·ªÅn ƒëen m·ªù -->
                <div id="cart-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 transition-opacity duration-300 ${document.getElementById('cart-sidebar')?.classList.contains('translate-x-full') ? 'hidden' : ''}" onclick="document.getElementById('cart-sidebar').classList.add('translate-x-full')"></div>
            
                <div id="cart-sidebar" class="fixed top-0 right-0 w-full md:w-96 h-full bg-white shadow-2xl z-40 transform transition-transform duration-300 ${cartClasses}">
                    <div class="flex justify-between items-center p-4 border-b border-amber-200 bg-amber-50">
                        <h3 class="text-xl font-bold text-amber-900 flex items-center">
                            <i data-lucide="shopping-basket" class="w-6 h-6 mr-2"></i> Gi·ªè H√†ng
                        </h3>
                        <button onclick="document.getElementById('cart-sidebar').classList.add('translate-x-full')" class="p-2 rounded-full hover:bg-gray-100 text-amber-800">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div class="p-4 overflow-y-auto h-[calc(100%-140px)]">
                        ${itemsInCart.length > 0 ? itemsInCart.map(entry => `
                            <div class="flex items-center justify-between py-3 border-b border-dashed border-amber-100">
                                <div class="flex-grow pr-4">
                                    <p class="font-semibold text-amber-900">${entry.item.name}</p>
                                    <p class="text-sm text-orange-600">${formatCurrency(entry.item.price)} x ${entry.quantity}</p>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <button onclick="updateCart('${entry.item.id}', -1)" class="p-1 text-sm bg-amber-200 rounded-full hover:bg-amber-300 transition duration-150">
                                        <i data-lucide="minus" class="w-4 h-4"></i>
                                    </button>
                                    <span class="w-6 text-center text-amber-900 font-medium">${entry.quantity}</span>
                                    <button onclick="updateCart('${entry.item.id}', 1)" class="p-1 text-sm bg-orange-500 text-white rounded-full hover:bg-orange-600 transition duration-150">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('') : '<p class="text-center text-gray-500 mt-10">Gi·ªè h√†ng tr·ªëng.</p>'}
                    </div>
                    
                    <div class="absolute bottom-0 w-full p-4 border-t border-amber-300 bg-white">
                        <div class="flex justify-between items-center mb-3">
                            <p class="text-lg font-bold text-amber-900">T·ªïng C·ªông:</p>
                            <p class="text-2xl font-extrabold text-red-600">${formatCurrency(total)}</p>
                        </div>
                        <button class="w-full py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition duration-150 shadow-lg" onclick="handleCheckout(${total})">
                            <i data-lucide="check-circle" class="w-5 h-5 inline mr-2"></i> Thanh To√°n
                        </button>
                    </div>
                </div>
            `;
        }

        function handleCheckout(total) {
            if (total === 0) {
                 showMessage("Gi·ªè h√†ng tr·ªëng! Vui l√≤ng ch·ªçn m√≥n.", 'warning');
                 return;
            }
            // Logic Thanh to√°n (Mock - trong th·ª±c t·∫ø s·∫Ω l∆∞u v√†o Firestore)
            showMessage(`ƒê√£ ƒë·∫∑t h√†ng th√†nh c√¥ng! T·ªïng c·ªông: ${formatCurrency(total)}`, 'success');
            
            // TTS
            speak(`C·∫£m ∆°n b·∫°n. ƒê∆°n h√†ng tr·ªã gi√° ${total.toLocaleString('vi-VN')} ƒë·ªìng ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t th√†nh c√¥ng.`);

            // X√≥a gi·ªè h√†ng
            cart = {};
            localStorage.removeItem('cart');
            renderApp();
        }
        
        // --- Custom Alert/Message ---
        function showMessage(message, type = 'info') {
            const messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            
            let classes = '';
            if (type === 'success') {
                classes = 'bg-green-100 text-green-800 border-green-400';
            } else if (type === 'warning') {
                classes = 'bg-yellow-100 text-yellow-800 border-yellow-400';
            } else { // info/error
                classes = 'bg-red-100 text-red-800 border-red-400';
            }
            
            messageBox.className = `p-3 rounded-lg border fixed top-4 left-1/2 -translate-x-1/2 z-50 shadow-lg transition-opacity duration-300 ${classes}`;
            messageBox.style.opacity = '1';
            
            setTimeout(() => {
                messageBox.style.opacity = '0';
            }, 3000);
        }

        function renderApp() {
            const appContainer = document.getElementById('app-container');
            if (!appContainer) return;

            // Hide loading screen
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }

            // Render Header
            document.getElementById('header-container').innerHTML = renderHeader();

            // Render Main Content (Menu/Login/Admin)
            document.getElementById('main-content-container').innerHTML = renderMainContent();

            // Render Cart Sidebar
            document.getElementById('cart-container').innerHTML = renderCartSidebar();

            // X·ª≠ l√Ω gi·ªè h√†ng ban ƒë·∫ßu (khi user m·ªü app)
            const storedCart = localStorage.getItem('cart');
            if (storedCart) {
                try {
                    cart = JSON.parse(storedCart);
                } catch(e) {
                    console.error("L·ªói parse gi·ªè h√†ng:", e);
                    cart = {};
                }
            }

            // Update debug info
            updateDebugInfo();

            renderLucideIcons();
        }

        function updateDebugInfo() {
            const statusText = document.getElementById('status-text');
            const itemCount = document.getElementById('item-count');
            const firebaseStatus = document.getElementById('firebase-status');
            const userStatus = document.getElementById('user-status');
            const roleStatus = document.getElementById('role-status');
            const viewStatus = document.getElementById('view-status');

            if (statusText) statusText.textContent = 'Loaded';
            if (itemCount) itemCount.textContent = menuItems.length;
            if (firebaseStatus) firebaseStatus.textContent = db ? 'Connected ‚úÖ' : 'Disconnected ‚ùå';
            
            if (userStatus) {
                const user = auth?.currentUser;
                userStatus.textContent = user ? user.email : 'Not logged in';
            }
            
            if (roleStatus) {
                roleStatus.textContent = isAdmin ? 'üëë Admin' : 'üë§ Customer';
            }
            
            if (viewStatus) {
                let viewText = currentView;
                if (isPreviewMode) viewText += ' (Preview)';
                viewStatus.textContent = viewText;
            }
        }

        // --- Kh·ªüi t·∫°o ·ª®ng d·ª•ng ---
        window.onload = function() {
            console.log("üåü ·ª®ng d·ª•ng Qu√°n Tr√† ƒê·ªì kh·ªüi ƒë·ªông...");

            initFirebase();
            window.updateCart = updateCart;
            window.setView = setView;
            window.setCategory = setCategory;
            window.handleLogin = handleLogin;
            window.handleLogout = handleLogout;
            window.toggleAdminMode = toggleAdminMode;
            window.handleCheckout = handleCheckout;
            window.saveItem = saveItem;
            window.deleteItem = deleteItem;
            window.handleSaveItem = handleSaveItem;
            window.handleChangePassword = handleChangePassword;
            window.loadItemForEdit = loadItemForEdit;
            window.clearAdminForm = clearAdminForm;
            window.speak = speak;
            window.loadMenuItemsOnce = loadMenuItemsOnce;
            window.openPriceModal = openPriceModal;
            window.closePriceModal = closePriceModal;
            window.savePriceUpdate = savePriceUpdate;
            window.openCategoryModal = openCategoryModal;
            window.closeCategoryModal = closeCategoryModal;
            window.addNewCategory = addNewCategory;
            window.editCategory = editCategory;
            window.deleteCategory = deleteCategory;

            // Fallback: Hide loading after 10 seconds if Firebase fails
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen && loadingScreen.style.display !== 'none') {
                    console.warn("‚ö†Ô∏è Firebase load timeout - showing app anyway");
                    loadingScreen.style.display = 'none';
                    updateDebugInfo();
                }
            }, 10000);

            renderApp(); // Render l·∫ßn ƒë·∫ßu
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fef3c7; /* Amber-100 light background */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #fef3c7;
        }
        ::-webkit-scrollbar-thumb {
            background: #d97706; /* Orange-700 */
            border-radius: 10px;
        }
    </style>
</head>

<body class="min-h-screen">
    <div id="app-container" class="relative">
        <div id="header-container">
            <!-- Header s·∫Ω ƒë∆∞·ª£c render t·∫°i ƒë√¢y -->
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="fixed inset-0 bg-amber-50 flex items-center justify-center z-50">
            <div class="text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-orange-600 mx-auto mb-4"></div>
                <h2 class="text-2xl font-bold text-amber-900 mb-2">Qu√°n Tr√† ƒê·ªì</h2>
                <p class="text-amber-700">ƒêang t·∫£i menu...</p>
                <p class="text-sm text-amber-600 mt-2">üí° N·∫øu load l√¢u, th·ª≠ enable Authentication trong Firebase Console</p>
            </div>
        </div>

        <div id="main-content-container">
            <!-- N·ªôi dung ch√≠nh (Menu, Login, Admin) s·∫Ω ƒë∆∞·ª£c render t·∫°i ƒë√¢y -->
        </div>

        <div id="cart-container">
            <!-- Gi·ªè h√†ng Sidebar s·∫Ω ƒë∆∞·ª£c render t·∫°i ƒë√¢y -->
        </div>
        
        <!-- H·ªôp th√¥ng b√°o t√πy ch·ªânh (thay th·∫ø alert) -->
        <div id="message-box" style="opacity: 0; pointer-events: none;" class="p-3 rounded-lg border fixed top-4 left-1/2 -translate-x-1/2 z-50 shadow-lg transition-opacity duration-300"></div>

        <!-- Price Update Modal -->
        <div id="price-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-6 rounded-xl max-w-md w-full mx-4">
                <h3 class="text-xl font-bold text-amber-900 mb-4">üí∞ C·∫≠p Nh·∫≠t Gi√°</h3>

                <div id="price-modal-content">
                    <!-- Content s·∫Ω ƒë∆∞·ª£c render b·ªüi JavaScript -->
                </div>

                <div class="flex gap-3 mt-6">
                    <button onclick="closePriceModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">H·ªßy</button>
                    <button onclick="savePriceUpdate()" class="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">L∆∞u</button>
                </div>
            </div>
        </div>

        <!-- Add Category Modal -->
        <div id="category-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-6 rounded-xl max-w-md w-full mx-4">
                <h3 class="text-xl font-bold text-amber-900 mb-4">‚ûï Th√™m Danh M·ª•c M·ªõi</h3>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">T√™n Danh M·ª•c</label>
                    <input type="text" id="new-category-name" placeholder="V√≠ d·ª•: ƒê·ªì Chay" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                </div>

                <div class="flex gap-3">
                    <button onclick="closeCategoryModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">H·ªßy</button>
                    <button onclick="addNewCategory()" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Th√™m</button>
                </div>
            </div>
        </div>

        <!-- Debug Info -->
        <div id="debug-info" class="fixed bottom-4 right-4 bg-black bg-opacity-80 text-white p-3 rounded-lg text-xs max-w-xs z-40">
            <div class="font-bold mb-2 text-green-400">üîç Debug Panel</div>
            <div>üîÑ Status: <span id="status-text">Loading...</span></div>
            <div>üìä Items: <span id="item-count">0</span></div>
            <div>üîó Firebase: <span id="firebase-status">Connecting...</span></div>
            <div>üë§ User: <span id="user-status">Not logged in</span></div>
            <div>üëë Role: <span id="role-status">Customer</span></div>
            <div>üì∫ View: <span id="view-status">customer</span></div>
        </div>

        <!-- Footer ƒë∆°n gi·∫£n -->
        <footer class="bg-amber-900 text-white p-4 mt-8 text-center text-sm">
            B·∫£n quy·ªÅn &copy; 2024 Qu√°n Tr√† ƒê·ªì. Ph√°t tri·ªÉn b·∫±ng HTML, Tailwind & Firebase.
        </footer>
    </div>
</body>
</html>